<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mogilev Express | –§–∏—Ç–Ω–µ—Å-–¥–æ—Å—Ç–∞–≤–∫–∞</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* –°—Ç–∏–ª–∏ –≤ –¥—É—Ö–µ –Ø–Ω–¥–µ–∫—Å Go */
        :root {
            --primary: #fc0; /* –ñ–µ–ª—Ç—ã–π */
            --black: #21201f;
            --gray: #f2f2f2;
            --green: #00b341;
        }
        body { margin: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--gray); -webkit-tap-highlight-color: transparent; }
        
        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        .header { background: var(--primary); padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 900; font-size: 18px; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; }
        
        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–æ–ª–µ–π (–ö–ª–∏–µ–Ω—Ç / –ö—É—Ä—å–µ—Ä) */
        .role-switch { background: rgba(255,255,255,0.3); padding: 4px; border-radius: 8px; display: flex; font-size: 12px; font-weight: bold; }
        .role-btn { padding: 6px 12px; border-radius: 6px; border: none; background: transparent; cursor: pointer; }
        .role-btn.active { background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* –ö–∞—Ä—Ç–∞ */
        #map { height: 50vh; width: 100%; z-index: 1; }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .panel { background: #fff; border-radius: 20px 20px 0 0; margin-top: -20px; position: relative; z-index: 2; padding: 20px; min-height: 40vh; box-shadow: 0 -4px 10px rgba(0,0,0,0.05); }
        
        /* –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .address-box { background: var(--gray); padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .price-tag { font-size: 28px; font-weight: 900; margin: 15px 0; }
        .btn-main { width: 100%; padding: 16px; background: var(--black); color: var(--primary); font-weight: bold; font-size: 16px; border: none; border-radius: 12px; cursor: pointer; transition: transform 0.1s; }
        .btn-main:active { transform: scale(0.98); }
        .btn-main:disabled { background: #ccc; color: #fff; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –∫—É—Ä—å–µ—Ä–∞ */
        .order-card { border: 1px solid #eee; border-radius: 12px; padding: 15px; margin-bottom: 15px; background: white; }
        .order-header { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 8px; }
        .fitness-badge { background: #e0f2fe; color: #0284c7; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: bold; display: inline-flex; align-items: center; gap: 4px; }
        
        /* –§–∏—Ç–Ω–µ—Å –≤–∏–¥–∂–µ—Ç */
        .fitness-stats { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-box { flex: 1; background: var(--black); color: white; padding: 12px; border-radius: 12px; text-align: center; }
        .stat-val { font-size: 20px; font-weight: 900; color: var(--primary); }
        .stat-label { font-size: 10px; opacity: 0.7; text-transform: uppercase; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo"><i class="fas fa-person-walking"></i> Mogilev Express</div>
        <div class="role-switch">
            <button class="role-btn active" onclick="switchRole('client')">–ó–∞–∫–∞–∑—á–∏–∫</button>
            <button class="role-btn" onclick="switchRole('courier')">–ö—É—Ä—å–µ—Ä</button>
        </div>
    </div>

    <div id="client-view">
        <div id="map"></div>
        <div class="panel">
            <h3 style="margin-top:0">–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
            <p style="font-size:12px; color:#888;">–ù–∞–∂–º–∏ –Ω–∞ –∫–∞—Ä—Ç—É: —Å–Ω–∞—á–∞–ª–∞ –û–¢–ö–£–î–ê, –ø–æ—Ç–æ–º –ö–£–î–ê.</p>
            
            <div class="address-box">
                <i class="fas fa-circle" style="color:var(--black); font-size:10px;"></i>
                <span id="addr-from">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –ê –Ω–∞ –∫–∞—Ä—Ç–µ...</span>
            </div>
            <div class="address-box">
                <i class="fas fa-square" style="color:var(--black); font-size:10px;"></i>
                <span id="addr-to">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –ë –Ω–∞ –∫–∞—Ä—Ç–µ...</span>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-size:12px; color:#888;">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                    <div class="price-tag"><span id="price-display">0.00</span> BYN</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:12px; color:#888;">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div>
                    <div style="font-weight:bold;"><span id="dist-display">0</span> –º</div>
                </div>
            </div>

            <button id="btn-order" class="btn-main" onclick="createOrder()" disabled>
                –ó–∞–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É
            </button>
        </div>
    </div>

    <div id="courier-view" class="hidden" style="padding: 20px; padding-bottom: 80px;">
        <div class="fitness-stats">
            <div class="stat-box">
                <div class="stat-val" id="total-steps">0</div>
                <div class="stat-label">–®–∞–≥–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" id="total-cal">0</div>
                <div class="stat-label">–ö–∫–∞–ª —Å–æ–∂–∂–µ–Ω–æ</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" id="wallet">0.00</div>
                <div class="stat-label">–ë–∞–ª–∞–Ω—Å (BYN)</div>
            </div>
        </div>

        <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã –≤ –ú–æ–≥–∏–ª–µ–≤–µ</h3>
        <div id="orders-list">
            <div style="text-align:center; color:#999; margin-top:40px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
        </div>
    </div>

    <script>
        // --- 1. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –î–ê–ù–ù–´–ï ---
        let map, markerA, markerB, line;
        let coordsA = null;
        let coordsB = null;
        
        // –§–µ–π–∫–æ–≤–∞—è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏)
        let orders = []; 
        let courierStats = { steps: 1240, calories: 85, balance: 5.00 }; // –°—Ç–∞—Ä—Ç —Å 5 —Ä—É–±–ª—è–º–∏

        // --- 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–ê–†–¢–´ ---
        function initMap() {
            // –¶–µ–Ω—Ç—Ä –ú–æ–≥–∏–ª–µ–≤–∞: –ø–ª–æ—â–∞–¥—å –õ–µ–Ω–∏–Ω–∞/–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∞—è
            map = L.map('map').setView([53.9006, 30.3313], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OSM'
            }).addTo(map);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–µ
            map.on('click', function(e) {
                handleMapClick(e.latlng);
            });
        }

        // --- 3. –õ–û–ì–ò–ö–ê –ó–ê–ö–ê–ó–ß–ò–ö–ê ---
        function handleMapClick(latlng) {
            if (!coordsA) {
                // –°—Ç–∞–≤–∏–º —Ç–æ—á–∫—É –ê
                coordsA = latlng;
                markerA = L.marker(latlng).addTo(map).bindPopup("–û—Ç–∫—É–¥–∞").openPopup();
                document.getElementById('addr-from').innerText = "–¢–æ—á–∫–∞ –ê (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã " + latlng.lat.toFixed(4) + ")";
            } else if (!coordsB) {
                // –°—Ç–∞–≤–∏–º —Ç–æ—á–∫—É –ë
                coordsB = latlng;
                markerB = L.marker(latlng).addTo(map).bindPopup("–ö—É–¥–∞").openPopup();
                document.getElementById('addr-to').innerText = "–¢–æ—á–∫–∞ –ë (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã " + latlng.lat.toFixed(4) + ")";
                
                // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é –∏ —Å—á–∏—Ç–∞–µ–º —Ü–µ–Ω—É
                drawRoute();
            } else {
                // –°–±—Ä–æ—Å, –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ —Ç—Ä–µ—Ç–∏–π —Ä–∞–∑
                resetMap();
                handleMapClick(latlng);
            }
        }

        function drawRoute() {
            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é
            line = L.polyline([coordsA, coordsB], {color: 'black', weight: 4, dashArray: '10, 10'}).addTo(map);
            map.fitBounds(line.getBounds(), {padding: [50, 50]});

            // –°—á–∏—Ç–∞–µ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏—é (–ø–æ –ø—Ä—è–º–æ–π –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã * 1.3 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫—Ä–∏–≤–∏–∑–Ω—ã —É–ª–∏—Ü)
            const distMeters = Math.round(map.distance(coordsA, coordsB) * 1.3);
            
            // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã (–¢–í–û–Ø –§–û–†–ú–£–õ–ê)
            // 2.5 BYN (–¥–æ 300–º) + 0.2 BYN –∑–∞ –∫–∞–∂–¥—ã–µ 100–º
            let price = 2.50;
            if (distMeters > 300) {
                const extraDist = distMeters - 300;
                const steps = Math.ceil(extraDist / 100);
                price += steps * 0.20;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('dist-display').innerText = distMeters;
            document.getElementById('price-display').innerText = price.toFixed(2);
            document.getElementById('btn-order').disabled = false;
            document.getElementById('btn-order').dataset.price = price.toFixed(2);
            document.getElementById('btn-order').dataset.dist = distMeters;
        }

        function resetMap() {
            if (markerA) map.removeLayer(markerA);
            if (markerB) map.removeLayer(markerB);
            if (line) map.removeLayer(line);
            coordsA = null;
            coordsB = null;
            document.getElementById('addr-from').innerText = "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –ê...";
            document.getElementById('addr-to').innerText = "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –ë...";
            document.getElementById('price-display').innerText = "0.00";
            document.getElementById('btn-order').disabled = true;
        }

        // --- 4. –°–û–ó–î–ê–ù–ò–ï –ó–ê–ö–ê–ó–ê ---
        function createOrder() {
            const price = parseFloat(document.getElementById('btn-order').dataset.price);
            const dist = parseInt(document.getElementById('btn-order').dataset.dist);
            
            const newOrder = {
                id: Math.floor(Math.random() * 10000),
                from: "–¢–æ—á–∫–∞ –ê",
                to: "–¢–æ—á–∫–∞ –ë",
                price: price,
                dist: dist,
                commission: (price * 0.15).toFixed(2), // 15% –∫–æ–º–∏—Å—Å–∏—è
                steps: Math.round(dist / 0.7), // –§–∏—Ç–Ω–µ—Å: —à–∞–≥–∏
                calories: Math.round((dist / 0.7) * 0.04) // –§–∏—Ç–Ω–µ—Å: –∫–∞–ª–æ—Ä–∏–∏
            };

            orders.push(newOrder);
            alert(`–ó–∞–∫–∞–∑ #${newOrder.id} —Å–æ–∑–¥–∞–Ω! –ü–µ—Ä–µ–∫–ª—é—á–∏—Å—å –≤ —Ä–µ–∂–∏–º –ö—É—Ä—å–µ—Ä–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ.`);
            resetMap();
            renderOrders(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É –∫—É—Ä—å–µ—Ä–æ–≤
        }

        // --- 5. –õ–û–ì–ò–ö–ê –ö–£–†–¨–ï–†–ê ---
        function renderOrders() {
            const list = document.getElementById('orders-list');
            if (orders.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#999; margin-top:40px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>';
                return;
            }

            list.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <span>üì¶ –ó–∞–∫–∞–∑ #${order.id}</span>
                        <span style="color:var(--green);">${order.price.toFixed(2)} BYN</span>
                    </div>
                    <div style="font-size:12px; color:#666; margin-bottom:10px;">
                        <i class="fas fa-map-marker-alt"></i> ${order.dist} –º–µ—Ç—Ä–æ–≤ –ø–µ—à–∫–æ–º
                    </div>
                    
                    <div style="background:#f9f9f9; padding:8px; border-radius:8px; font-size:11px; margin-bottom:10px;">
                        <div style="display:flex; justify-content:space-between;">
                            <span>–ö–æ–º–∏—Å—Å–∏—è —Å–µ—Ä–≤–∏—Å–∞ (15%):</span>
                            <b>${order.commission} BYN</b>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:4px; color:#0284c7;">
                            <span><i class="fas fa-shoe-prints"></i> –¢–≤–æ—è –≤—ã–≥–æ–¥–∞:</span>
                            <b>+${order.steps} —à–∞–≥–æ–≤</b>
                        </div>
                    </div>

                    <button class="btn-main" style="padding:10px; font-size:14px;" onclick="takeOrder(${order.id})">
                        –í–∑—è—Ç—å –∑–∞–∫–∞–∑
                    </button>
                </div>
            `).join('');
        }

        function takeOrder(id) {
            const orderIndex = orders.findIndex(o => o.id === id);
            const order = orders[orderIndex];

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
            if (courierStats.balance < order.commission) {
                alert(`–û—à–∏–±–∫–∞! –ù–∞ –±–∞–ª–∞–Ω—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∫–æ–º–∏—Å—Å–∏–∏ (${order.commission} BYN). –ü–æ–ø–æ–ª–Ω–∏ —Å—á–µ—Ç.`);
                return;
            }

            // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            if(confirm(`–°–ø–∏—Å–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é ${order.commission} BYN –∏ –≤–∑—è—Ç—å –∑–∞–∫–∞–∑?`)) {
                // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
                courierStats.balance -= parseFloat(order.commission);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏—Ç–Ω–µ—Å-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                courierStats.steps += order.steps;
                courierStats.calories += order.calories;

                // –£–¥–∞–ª—è–µ–º –∑–∞–∫–∞–∑ –∏–∑ —Å–ø–∏—Å–∫–∞ (–∫–∞–∫ –±—É–¥—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω)
                orders.splice(orderIndex, 1);
                
                updateCourierStats();
                renderOrders();
                alert(`–ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω! –í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ${order.price} BYN (–Ω–∞–ª–∏—á–Ω—ã–º–∏) –∏ —Å–æ–∂–≥–ª–∏ ${order.calories} –∫–∫–∞–ª.`);
            }
        }

        function updateCourierStats() {
            document.getElementById('wallet').innerText = courierStats.balance.toFixed(2);
            document.getElementById('total-steps').innerText = courierStats.steps;
            document.getElementById('total-cal').innerText = courierStats.calories;
        }

        // --- 6. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–û–ú ---
        function switchRole(role) {
            document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            if (role === 'client') {
                document.getElementById('client-view').classList.remove('hidden');
                document.getElementById('courier-view').classList.add('hidden');
                setTimeout(() => map.invalidateSize(), 100); // –ß–∏–Ω–∏–º –∫–∞—Ä—Ç—É –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ
            } else {
                document.getElementById('client-view').classList.add('hidden');
                document.getElementById('courier-view').classList.remove('hidden');
                renderOrders();
                updateCourierStats();
            }
        }

        // –ó–∞–ø—É—Å–∫
        initMap();
        updateCourierStats();

    </script>
</body>
</html>
 
